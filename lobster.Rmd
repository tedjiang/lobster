---
title: "lobster"
author: "Yingfei Jiang"
date: "11/12/2018"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

library(tidyverse)
library(vcdExtra)
library(ggpubr)

lob_a_draft <- read_csv("lobster_size_abundance.csv")
lob_t_draft <- read_csv("lobster_traps.csv")

```

```{r}

#Some basic data wrangling in this chunk, column lob_year is for future use when plotting trend, here i am assuming fishing season "x-x+1" is counted as year x+1. This means when we analyze trap count in the future, it is the trap count before the lobster count of the same year, which is collected in August  

lob_a_draft <- as.data.frame(lob_a_draft) #coerce to data.frame
lob_a <- expand.dft(lob_a_draft, freq = "COUNT") #get the data into case format


lob_t <- lob_t_draft %>% 
  mutate(
    lob_year = case_when(
      FISHING_SEASON == "2012-2013" ~ 2013,
      FISHING_SEASON == "2013-2014" ~ 2014,
      FISHING_SEASON == "2014-2015" ~ 2015,
      FISHING_SEASON == "2015-2016" ~ 2016,
      FISHING_SEASON == "2016-2017" ~ 2017
    )
  )

```

```{r}

#Plotting trend in lobster count and trap count

lob_a_trend <- lob_a %>%
  group_by(YEAR, SITE) %>%
  summarize(lob_counts = length(SIZE))

lob_t_trend <- lob_t %>%
  filter (
    SITE == "AQUE" |
    SITE == "NAPL" |
    SITE == "MOHK" |
    SITE == "IVEE" |
    SITE == "CARP"
    ) %>% 
  group_by(lob_year, SITE) %>% 
  summarize(trap_counts = sum(TRAPS)) %>% 
  #summarize(trap_counts = round(mean(TRAPS), 2)) %>% 
  rename(YEAR = lob_year)

trend <- full_join(lob_a_trend, lob_t_trend)

trend_plot <- ggplot(trend) +
  geom_line(aes(x = YEAR, y = lob_counts, color = "Lobster Counts")) +
  geom_line(aes(x = YEAR - 0.5, y = trap_counts/2, color = "Trap Counts")) +
  scale_y_continuous(sec.axis = sec_axis(~./0.5, name = "Trap Counts")) +
  facet_wrap(~SITE, scale = "free") +
  theme_pubr() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +
  labs(x = "Year",
       y = "Lobster Counts",
       colour = "Counts")
  

trend_plot

```

